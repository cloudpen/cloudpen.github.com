---
title: 《网络程序设计案例教程》任务4.5：多线程应用
category: lesson
layout: post
---

## 教学目标

1. 掌握多线程的概念 

2. 了解多线程程序的特点和基本使用方法

3. 掌握System.Threading命名空间的主要功能和使用方法


## 教学重点

掌握多线程的概念及程序实现

## 教学难点

System.Threading命名空间在多线程程序中的实现应用


## 教学课时

2课时

## 教学过程

一、复习导入

前一段时间，我们重点学习了ASP.NET中有关网络应用的类库。今天我们来学习一个关于系统运行优化方面的类库，多线程。

二、教学新课

1.与“线程”相关的概念

（1）程序、进程和线程

程序是一段静态的代码，是应用软件执行的蓝本。

进程是程序在某个数据集上的一次执行过程。进程是一个动态的实体，它有自己的生命周期，有产生、运行、等待、撤销等状态。进程和程序并不是一一对应的，一个程序在不同的数据庥上执行就成为不同的进程。

一个进程可以由多个线程组成，线程是进程中的一个执行流，每个线程也有其自身的产生、存在和消亡的过程，也是一个动态的概念。每个进程都有自己的专有寄存器，但线程间可以共享相同的内存单元，并可以利用这些单元来实现数据交换、实时通信以及必要的同步操作。

（2）多线程的概念
和多线程对应的概念是单线程，即一个程序只有一条从头到尾的执行路线。我们之前所写出的来的程序都属于这一类型。在实际应用中，单线程方式不是最佳方案。多线程是指一个进程中同时存在多个执行体，按多条不同的路线执行并协同完成工作的情况。

使用多线程可以提高CPU的使用率，在多线程程序中，一个线程等待其他资源的时候，CPU可以运行其他的线程而不是等待，这样就大大提高了程序总体的运行速度。当然，多线程也存在一些缺点，比如：线程需要占用内存，线程越多，占用内存越多；多线程需要协调和管理，需要开销额外的CPU时间跟踪、管理线程等待。

2.System.Threading命名空间

System.Threading命名空间提供了许多和多线程相关的类、枚举、接口。经常用到的有以下几种。

<table>
<tr><th>类名</th><th>描述</th></tr>
<tr><td>ReaderWriterLock</td><td>定义支持单个写线程和多个读线程的锁</td></tr>
<tr><td>Semaphore</td><td>限制可同时访问某一资源或资源池的线程数</td></tr>
<tr><td>Thread</td><td>创建并控制线程，设置其优先级并获取状态</td></tr>
<tr><td>ThreadStateException</td><td>当Thread处于对方法调用无效的ThreadState时引发的异常</td></tr>
</table>

同时其包括的枚举中，还有ThreadState是用来指定Thread的执行状态的。

3.关于Thread类

Thread类主要提供了多线程处理的一般方法，比如:Join方法可以用来阻止调用线程，直到某个线程终止时为止;Resume方法用来恢复已挂起的进程;Start方法用来安排进行执行；Suspend方法用来挂起线程。

例如：

{% highlight c# %}
Thread t = new Thread(new ThreadStart(ThreadProc));
t.Start();
Response.Write(t.ThreadState);
t.Suspend();
Thread.Sleep(100);
t.Resume();
{% endhighlight %}  

4.关于线程的状态

一个线程一旦被创建，它就至少处于其中一个状态中，直到终止。具体状态类型可以参阅课本112页内容。

5.多线程案例

要点：

创建进程，并通过for循环运行多个进程，从而实现多线程的执行效果。

三、学生练习

完成课本任务，并完成118页上第6题作业

四、课堂小结

本节课主要学习了多线程的相关知识，并通过ASP.NET实现了多线程执行了效果。
